

<ion-header *ngIf="todo" [translucent]="true" id="header">

  <!-- HEADER -->
  <ion-toolbar class="toolbar-parent">

    <app-todo-header-top 
      [todo]="todo"
      (goBackEmitter)="goBackTodo()"

    ></app-todo-header-top>

    <div>
      <ion-row class="sub-toolbar" id="sub-toolbar">

        <app-todo-header-left-informations [todo]="todo"></app-todo-header-left-informations>
    
        <app-todo-header-right-buttons 
          [todo]="todo"
          (editModeEmitter)="modifyTodo($event)"
          (deleteEmitter)="showConfirmDeleteTodo()"
          (validationEmitter)="setTodoValidation($event)"
          ></app-todo-header-right-buttons>

      </ion-row>
    </div>
    
  </ion-toolbar>
</ion-header>



<ion-content *ngIf="todo" [fullscreen]="true" [scrollEvents]="true" (ionScroll)="onContentScroll($event)">


  <!-- <ion-button (click)="exportTodo()">
    Export data
  </ion-button> -->

  

  
  <ion-list class="list-page" >


    <app-title-category-edit *ngIf="this.editMode" [todo]="this.todo"></app-title-category-edit>


    <app-custom-config *ngIf="this.editMode" [configArray]="this.todo.config" [todo]="this.todo"></app-custom-config>


    <app-todo-description [todo]="todo"></app-todo-description>


    <app-todo-priority-edit *ngIf="this.editMode" [todo]="this.todo"></app-todo-priority-edit>


    <app-date-selector [todo]="todo" [editMode]="editMode"></app-date-selector>

    
    <!-- List sub tasks -->

    <div *ngIf="this.mainTodo.config.subtasks" >

      <ion-list class="sub-todo-list item-padding">

        <div *ngIf="this.todo !== this.mainTodo" class="project-task">
          <ion-label class="sub-todos-label" color="primary">{{'PROJECT' | translate}}</ion-label>

          <app-sub-task 
            [mainId]="mainTodo.id"
            [todos]="todos" 
            [parentTask]="mainTodo" 
            [subTask]="mainTodo" 
            
            (todoSelectedEmitter)="onNewTodoSelected($event)"
            [page]="'todo'" 
            [hideSubTasks]="hideDoneTasks"

            [developped]="false"
          ></app-sub-task>
        </div>


        <app-todo-sub-tasks-header
          [todo]="todo" [mainTodo]="mainTodo"
          (subModeChangeEmitter)="changeSubMode($event)" (hideDoneTasksChangeEmitter)="changeHideDoneTasks($event)"
        ></app-todo-sub-tasks-header>

        <app-button-add-sub-task *ngIf="editMode" [parentTask]="todo" [modalConfig]="modalConfig"></app-button-add-sub-task>

        
        <!-- SUBTAKS LIST -->

        <div *ngIf="subMode === 'tree'">
          <!-- <div cdkDropList [cdkDropListData]="todo.list" (cdkDropListDropped)="drop($event)"> -->
          <div cdkDropListGroup>
            <div *ngFor="let subTodo of todo.list; let index = index" >
              <div cdkDropList [cdkDropListData]="subTasksList[index]" 
              (cdkDropListDropped)="drop($event)" *ngIf="!hideDoneTasks || !subTodo.isDone">

                <app-sub-task 
                [mainId]="mainTodo.id"
                [todos]="todos" 
                [parentTask]="todo" 
                [subTask]="subTodo" 
                
                (todoSelectedEmitter)="onNewTodoSelected($event)"
                [page]="'todo'" 
                [hideSubTasks]="hideDoneTasks"
                ></app-sub-task>
              </div>
            </div >
          </div>

          <div *ngIf="todo.list.length === 0">
            <ion-label class="sub-todos-label" color="primary">{{'NO SUB TASKS' | translate}}</ion-label>
          </div>
        </div>

      </ion-list> 

    </div>

  </ion-list>

  <!-- CONCEPTOR -->

  <app-graph *ngIf="subMode === 'graph'" 
    [mainTodo]="mainTodo"
    [selectedTodo]="todo"
    (todoSelectedEmitter)="onNewTodoSelected($event)"

    ></app-graph>

  <div  class='scroll-step'></div>

</ion-content>


<ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="editMode && !modalConfig.open">
  <ion-fab-button [disabled]="!canSaveTodo()" (click)="saveTodo()">
    <ion-icon name="checkmark-outline" ></ion-icon>
  </ion-fab-button>
</ion-fab>


<div *ngIf="modalConfig.open">
  <app-add-modal [modalConfig]="modalConfig"></app-add-modal>
</div>
<!-- <div *ngIf="newModalConfig.open">
  <app-add-modal [modalConfig]="newModalConfig"></app-add-modal>
</div> -->